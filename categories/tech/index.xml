<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Tech on Electronic-Wasteçš„åšå®¢</title><link>https://blog.electronicwaste.cn/categories/tech/</link><description>Recent content in Tech on Electronic-Wasteçš„åšå®¢</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Tue, 26 Dec 2023 00:00:00 +0000</lastBuildDate><atom:link href="https://blog.electronicwaste.cn/categories/tech/index.xml" rel="self" type="application/rss+xml"/><item><title>Structured Log</title><link>https://blog.electronicwaste.cn/p/structured-log/</link><pubDate>Tue, 26 Dec 2023 00:00:00 +0000</pubDate><guid>https://blog.electronicwaste.cn/p/structured-log/</guid><description>&lt;h2 id="overview">Overview&lt;/h2>
&lt;p>æ—¥å¿—ä½œä¸ºä¸€ç§å¸®åŠ©å¼€å‘è€…å¿«é€Ÿå®šä½é—®é¢˜çš„å·¥å…·ï¼Œåœ¨å„ä¸ªå¼€æºé¡¹ç›®ä»¥åŠå®é™…ç”Ÿäº§ç¯å¢ƒä¸­éƒ½è¢«å¹¿æ³›ä½¿ç”¨ï¼Œå…¶é‡è¦æ€§ä¸è¨€è€Œå–»ã€‚ä½†æ˜¯ï¼Œå¼€å‘è€…å¾€å¾€æ˜¯æ‡’æƒ°çš„ï¼Œåœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ä¸ºäº†å›¾çœäº‹ï¼Œç»å¸¸ä¸å†™logï¼ˆæ¯”å¦‚è¯´æˆ‘ï¼‰ï¼Œæˆ–è€…å†™çš„logæå…¶ç²—ç³™ï¼ˆè¯¸å¦‚&lt;code>fmt.Println(&amp;quot;OK&amp;quot;)&lt;/code>ä¹‹æµ&amp;hellip;ï¼‰ã€‚ä¸€æ—¦ç¨‹åºå‡ºç°äº†é—®é¢˜ï¼Œæ ¹æ®ç°æœ‰çš„æ—¥å¿—å¾€å¾€ä¸èƒ½å¾ˆå¥½åœ°å®šä½åˆ°é”™è¯¯æ‰€åœ¨çš„åœ°æ–¹ï¼Œå¾—èŠ±æ›´å¤šçš„æ—¶é—´æ‰“æ›´å¤šlogï¼ˆæ›´æ˜¯ä¾æ‰˜ç­”è¾©ï¼‰å»æ‰¾bugã€‚&lt;/p>
&lt;p>ç—›å®šæ€ç—›ï¼Œæˆ‘æ‰“ç®—æ¥å­¦ä¹ Logçš„Best Practiceï¼Œè®©æˆ‘ä¹‹ådebugä¸è¦å†é‚£ä¹ˆç—›è‹¦ï¼Œå†™çš„æ—¥å¿—ä¸è¦å†é‚£ä¹ˆç­”è¾©ğŸ¤¡&lt;/p>
&lt;p>äºæ˜¯å°±æœ‰äº†æœ¬ç« &lt;strong>Structured Log&lt;/strong>ï¼&lt;/p>
&lt;h2 id="ä»€ä¹ˆæ˜¯structured-log">ä»€ä¹ˆæ˜¯Structured Log&lt;/h2>
&lt;p>æ„æ€æ˜¯&lt;strong>ç»“æ„åŒ–çš„æ—¥å¿—&lt;/strong>ï¼Œæˆ‘è§‰å¾—ä¸»è¦æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>æ—¥å¿—æ ¼å¼&lt;/strong>ï¼šä»åŸºäºé”®-å€¼ï¼ˆåƒsyslogï¼‰åˆ°éå¸¸ç»“æ„åŒ–å’Œè¯¦ç»†ï¼ˆåƒJSONï¼‰ã€‚æ•°æ®è¶Šç»“æ„åŒ–â€”â€”æ¯è¡Œæ—¥å¿—å°±è¶Šå¤§ï¼Œå°½ç®¡æ›´æ˜“äºæŸ¥è¯¢å’ŒåŒ…å«æ›´ä¸°å¯Œçš„ä¿¡æ¯ã€‚&lt;/li>
&lt;li>&lt;strong>ç­‰çº§æ—¥å¿—ï¼ˆæˆ–æ—¥å¿—ç­‰çº§ï¼‰&lt;/strong>ï¼šä¸åŒç­‰çº§å¯¹åº”ç€ä¸åŒé‡è¦æ€§çš„æ—¥å¿—ã€‚å¯è§æ€§å¯é™åˆ¶å•ä¸ªç­‰çº§ï¼Œä»…é™äºæŸäº›é‡è¦æ€§æˆ–ç­‰çº§ä»¥ä¸Šçš„æ—¥å¿—ï¼ˆå¦‚ï¼šä»…è®°å½•WARNå’Œæ›´é«˜ç­‰çº§ï¼‰ã€‚é€šå¸¸æ—¥å¿—ç­‰çº§åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ˜¯é™æ€çš„ï¼ŒæŸ¥æ‰¾DEBUGç­‰çº§çš„æ—¥å¿—é€šå¸¸éœ€è¦é‡æ–°éƒ¨ç½²ã€‚&lt;/li>
&lt;li>&lt;strong>å› æœé¡ºåº&lt;/strong>ï¼šä¿å­˜å†™å…¥çš„å®é™…æ—¶é—´&lt;/li>
&lt;li>&lt;strong>æ—¥å¿—å…³è”&lt;/strong>ï¼šèƒ½çœ‹åˆ°ä¸ç‰¹å®šè¯·æ±‚æˆ–ç‰¹å®šäº‹ä»¶ç›¸å…³çš„æ‰€æœ‰æ—¥å¿—ï¼Œå¸®åŠ©æˆ‘ä»¬æ·±å…¥åˆ°ç‰¹å®šè¯·æ±‚çš„ç›¸å…³ä¿¡æ¯ä¸­&lt;/li>
&lt;/ul>
&lt;h2 id="logrus">Logrus&lt;/h2>
&lt;p>Logrusæ˜¯ä¸€ä¸ªå¸¸ç”¨çš„æ—¥å¿—åº“ï¼Œæœ‰å„ç§ä¸°å¯Œçš„ç‰¹æ€§&lt;/p>
&lt;h3 id="æ”¯æŒä¸åŒçš„æ—¥å¿—ç­‰çº§">æ”¯æŒä¸åŒçš„æ—¥å¿—ç­‰çº§&lt;/h3>
&lt;p>Traceã€Debugã€Infoã€Warningã€Errorã€Fatalã€Panic&lt;/p>
&lt;p>æ—¥å¿—ç­‰çº§ä¾æ¬¡ä¸Šå‡ï¼Œå¯ä»¥é€šè¿‡SetLevelå‡½æ•°è®¾ç½®æ—¥å¿—ç­‰çº§ï¼Œæ¯”å¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">logrus&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">SetLevel&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">InfoLevel&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™æ ·å­åªæœ‰Infoç­‰çº§åŠä»¥ä¸Šçš„æ—¥å¿—ä¼šè¢«æ‰“å°&lt;/p>
&lt;h3 id="å¯æ‰©å±•çš„hookæœºåˆ¶">å¯æ‰©å±•çš„Hookæœºåˆ¶&lt;/h3>
&lt;p>å…è®¸ä½¿ç”¨è€…é€šè¿‡Hookçš„æ–¹å¼å°†æ—¥å¿—åˆ†å‘åˆ°ä»»æ„åœ°æ–¹ï¼Œå¦‚`æœ¬åœ°æ—¥å¿—æ–‡ä»¶ï¼Œlogstashï¼Œelasticsearchæˆ–è€…mqç­‰ï¼Œæˆ–è€…é€šè¿‡Hookå®šä¹‰æ—¥å¿—å†…å®¹å’Œæ ¼å¼&lt;/p>
&lt;h3 id="å¯é€‰çš„æ—¥å¿—è¾“å‡ºæ ¼å¼">å¯é€‰çš„æ—¥å¿—è¾“å‡ºæ ¼å¼&lt;/h3>
&lt;p>å†…ç½®äº†ä¸¤ç§æ—¥å¿—æ ¼å¼JSONFormaterå’ŒTextFormaterï¼Œè¿˜å¯ä»¥è‡ªå®šä¹‰æ—¥å¿—æ ¼å¼&lt;/p>
&lt;h3 id="filedæœºåˆ¶">Filedæœºåˆ¶&lt;/h3>
&lt;p>å¯ä»¥é€šè¿‡Fieldæœºåˆ¶è¿›è¡Œç»“æ„åŒ–çš„æ—¥å¿—è®°å½•ï¼Œé€šå¸¸å°†ä¸€äº›å­—æ®µå§‹ç»ˆåŠ å…¥åˆ°æ—¥å¿—è¯­å¥ä¸­ä¼šå¾ˆæœ‰å¸®åŠ©&lt;/p>
&lt;p>ç›¸æ¯”äº&lt;code>log.Fatalf(&amp;quot;Failed to send event %s to topic&amp;quot;, event, topic)&lt;/code>&lt;/p>
&lt;p>ä½¿ç”¨å¦‚ä¸‹çš„æ—¥å¿—æ›´åŠ åˆé€‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">WithFields&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Fields&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;event&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">event&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;topic&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">topic&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}).&lt;/span>&lt;span class="nf">Fatal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Failed to send event.&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>é™¤äº†&lt;code>WithField&lt;/code>å’Œ&lt;code>WithFields&lt;/code>æ·»åŠ çš„å­—æ®µä»¥å¤–ï¼Œä¸€äº›å­—æ®µä¼šè‡ªåŠ¨æ·»åŠ åˆ°æ‰€æœ‰æ—¥è®°è®°å½•ä¸­ï¼š&lt;/p>
&lt;ol>
&lt;li>timeï¼šè®°å½•æ—¥å¿—çš„æ—¶é—´æˆ³&lt;/li>
&lt;li>msgï¼šè®°å½•çš„æ—¥å¿—ä¿¡æ¯&lt;/li>
&lt;li>levelï¼šè®°å½•çš„æ—¥å¿—çº§åˆ«&lt;/li>
&lt;/ol>
&lt;h3 id="çº¿ç¨‹å®‰å…¨æœºåˆ¶">çº¿ç¨‹å®‰å…¨æœºåˆ¶&lt;/h3>
&lt;p>é»˜è®¤çš„loggeråœ¨å¹¶å‘å†™çš„æ—¶å€™æ˜¯å—mutexä¿æŠ¤çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ˜¯çº¿ç¨‹å®‰å…¨çš„&lt;/p></description></item></channel></rss>